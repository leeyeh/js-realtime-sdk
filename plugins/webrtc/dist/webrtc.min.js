!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("leancloud-realtime")):"function"==typeof define&&define.amd?define("webrtc",["exports","leancloud-realtime"],e):e(t.AV=t.AV||{},t.AV)}(this,function(t,e){"use strict";var n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function o(t,e){return t(e={exports:{}},e.exports),e.exports}var i=function(t,e){return{value:e,done:!!t}},c={},a={}.toString,u=function(t){return a.call(t).slice(8,-1)},s=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==u(t)?t.split(""):Object(t)},f=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t},l=function(t){return s(f(t))},p=o(function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)}),h=o(function(t){var e=t.exports={version:"2.5.7"};"number"==typeof __e&&(__e=e)}),d=(h.version,function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}),v=function(t,e,n){if(d(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,o){return t.call(e,n,r,o)}}return function(){return t.apply(e,arguments)}},y=function(t){return"object"==typeof t?null!==t:"function"==typeof t},_=function(t){if(!y(t))throw TypeError(t+" is not an object!");return t},m=function(t){try{return!!t()}catch(t){return!0}},g=!m(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),b=p.document,w=y(b)&&y(b.createElement),C=function(t){return w?b.createElement(t):{}},S=!g&&!m(function(){return 7!=Object.defineProperty(C("div"),"a",{get:function(){return 7}}).a}),O=function(t,e){if(!y(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!y(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!y(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!y(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")},E=Object.defineProperty,A={f:g?Object.defineProperty:function(t,e,n){if(_(t),e=O(e,!0),_(n),S)try{return E(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},P=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},T=g?function(t,e,n){return A.f(t,e,P(1,n))}:function(t,e,n){return t[e]=n,t},j={}.hasOwnProperty,x=function(t,e){return j.call(t,e)},I=function(t,e,n){var r,o,i,c=t&I.F,a=t&I.G,u=t&I.S,s=t&I.P,f=t&I.B,l=t&I.W,d=a?h:h[e]||(h[e]={}),y=d.prototype,_=a?p:u?p[e]:(p[e]||{}).prototype;for(r in a&&(n=e),n)(o=!c&&_&&void 0!==_[r])&&x(d,r)||(i=o?_[r]:n[r],d[r]=a&&"function"!=typeof _[r]?n[r]:f&&o?v(i,p):l&&_[r]==i?function(t){var e=function(e,n,r){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,n)}return new t(e,n,r)}return t.apply(this,arguments)};return e.prototype=t.prototype,e}(i):s&&"function"==typeof i?v(Function.call,i):i,s&&((d.virtual||(d.virtual={}))[r]=i,t&I.R&&y&&!y[r]&&T(y,r,i)))};I.F=1,I.G=2,I.S=4,I.P=8,I.B=16,I.W=32,I.U=64,I.R=128;var L,M=I,R=T,N=Math.ceil,D=Math.floor,k=function(t){return isNaN(t=+t)?0:(t>0?D:N)(t)},F=Math.min,W=function(t){return t>0?F(k(t),9007199254740991):0},V=Math.max,G=Math.min,K=o(function(t){var e=p["__core-js_shared__"]||(p["__core-js_shared__"]={});(t.exports=function(t,n){return e[t]||(e[t]=void 0!==n?n:{})})("versions",[]).push({version:h.version,mode:"pure",copyright:"Â© 2018 Denis Pushkarev (zloirock.ru)"})}),Y=0,B=Math.random(),q=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++Y+B).toString(36))},U=K("keys"),H=function(t){return U[t]||(U[t]=q(t))},z=(L=!1,function(t,e,n){var r,o=l(t),i=W(o.length),c=function(t,e){return(t=k(t))<0?V(t+e,0):G(t,e)}(n,i);if(L&&e!=e){for(;i>c;)if((r=o[c++])!=r)return!0}else for(;i>c;c++)if((L||c in o)&&o[c]===e)return L||c||0;return!L&&-1}),J=H("IE_PROTO"),Q=function(t,e){var n,r=l(t),o=0,i=[];for(n in r)n!=J&&x(r,n)&&i.push(n);for(;e.length>o;)x(r,n=e[o++])&&(~z(i,n)||i.push(n));return i},X="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),Z=Object.keys||function(t){return Q(t,X)},$=g?Object.defineProperties:function(t,e){_(t);for(var n,r=Z(e),o=r.length,i=0;o>i;)A.f(t,n=r[i++],e[n]);return t},tt=p.document,et=tt&&tt.documentElement,nt=H("IE_PROTO"),rt=function(){},ot=function(){var t,e=C("iframe"),n=X.length;for(e.style.display="none",et.appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),ot=t.F;n--;)delete ot.prototype[X[n]];return ot()},it=Object.create||function(t,e){var n;return null!==t?(rt.prototype=_(t),n=new rt,rt.prototype=null,n[nt]=t):n=ot(),void 0===e?n:$(n,e)},ct=o(function(t){var e=K("wks"),n=p.Symbol,r="function"==typeof n;(t.exports=function(t){return e[t]||(e[t]=r&&n[t]||(r?n:q)("Symbol."+t))}).store=e}),at=A.f,ut=ct("toStringTag"),st=function(t,e,n){t&&!x(t=n?t:t.prototype,ut)&&at(t,ut,{configurable:!0,value:e})},ft={};T(ft,ct("iterator"),function(){return this});var lt=function(t,e,n){t.prototype=it(ft,{next:P(1,n)}),st(t,e+" Iterator")},pt=function(t){return Object(f(t))},ht=H("IE_PROTO"),dt=Object.prototype,vt=Object.getPrototypeOf||function(t){return t=pt(t),x(t,ht)?t[ht]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?dt:null},yt=ct("iterator"),_t=!([].keys&&"next"in[].keys()),mt=function(){return this},gt=function(t,e,n,r,o,i,a){lt(n,e,r);var u,s,f,l=function(t){if(!_t&&t in v)return v[t];switch(t){case"keys":case"values":return function(){return new n(this,t)}}return function(){return new n(this,t)}},p=e+" Iterator",h="values"==o,d=!1,v=t.prototype,y=v[yt]||v["@@iterator"]||o&&v[o],_=y||l(o),m=o?h?l("entries"):_:void 0,g="Array"==e&&v.entries||y;if(g&&(f=vt(g.call(new t)))!==Object.prototype&&f.next&&st(f,p,!0),h&&y&&"values"!==y.name&&(d=!0,_=function(){return y.call(this)}),a&&(_t||d||!v[yt])&&T(v,yt,_),c[e]=_,c[p]=mt,o)if(u={values:h?_:l("values"),keys:i?_:l("keys"),entries:m},a)for(s in u)s in v||R(v,s,u[s]);else M(M.P+M.F*(_t||d),e,u);return u};gt(Array,"Array",function(t,e){this._t=l(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,n=this._i++;return!t||n>=t.length?(this._t=void 0,i(1)):i(0,"keys"==e?n:"values"==e?t[n]:[n,t[n]])},"values");c.Arguments=c.Array;for(var bt=ct("toStringTag"),wt="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),Ct=0;Ct<wt.length;Ct++){var St=wt[Ct],Ot=p[St],Et=Ot&&Ot.prototype;Et&&!Et[bt]&&T(Et,bt,St),c[St]=c.Array}var At,Pt=(At=!0,function(t,e){var n,r,o=String(f(t)),i=k(e),c=o.length;return i<0||i>=c?At?"":void 0:(n=o.charCodeAt(i))<55296||n>56319||i+1===c||(r=o.charCodeAt(i+1))<56320||r>57343?At?o.charAt(i):n:At?o.slice(i,i+2):r-56320+(n-55296<<10)+65536});gt(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,n=this._i;return n>=e.length?{value:void 0,done:!0}:(t=Pt(e,n),this._i+=t.length,{value:t,done:!1})});var Tt=ct("toStringTag"),jt="Arguments"==u(function(){return arguments}()),xt=function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),Tt))?n:jt?u(e):"Object"==(r=u(e))&&"function"==typeof e.callee?"Arguments":r},It=ct("iterator"),Lt=h.isIterable=function(t){var e=Object(t);return void 0!==e[It]||"@@iterator"in e||c.hasOwnProperty(xt(e))},Mt=o(function(t){t.exports={default:Lt,__esModule:!0}});r(Mt);var Rt=ct("iterator"),Nt=h.getIteratorMethod=function(t){if(void 0!=t)return t[Rt]||t["@@iterator"]||c[xt(t)]},Dt=h.getIterator=function(t){var e=Nt(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return _(e.call(t))},kt=o(function(t){t.exports={default:Dt,__esModule:!0}});r(kt);var Ft,Wt,Vt,Gt=r(o(function(t,e){e.__esModule=!0;var n=o(Mt),r=o(kt);function o(t){return t&&t.__esModule?t:{default:t}}e.default=function(){return function(t,e){if(Array.isArray(t))return t;if((0,n.default)(Object(t)))return function(t,e){var n=[],o=!0,i=!1,c=void 0;try{for(var a,u=(0,r.default)(t);!(o=(a=u.next()).done)&&(n.push(a.value),!e||n.length!==e);o=!0);}catch(t){i=!0,c=t}finally{try{!o&&u.return&&u.return()}finally{if(i)throw c}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()})),Kt=function(t,e,n,r){try{return r?e(_(n)[0],n[1]):e(n)}catch(e){var o=t.return;throw void 0!==o&&_(o.call(t)),e}},Yt=ct("iterator"),Bt=Array.prototype,qt=o(function(t){var e={},n={},r=t.exports=function(t,r,o,i,a){var u,s,f,l,p,h=a?function(){return t}:Nt(t),d=v(o,i,r?2:1),y=0;if("function"!=typeof h)throw TypeError(t+" is not iterable!");if(void 0===(p=h)||c.Array!==p&&Bt[Yt]!==p){for(f=h.call(t);!(s=f.next()).done;)if((l=Kt(f,d,s.value,r))===e||l===n)return l}else for(u=W(t.length);u>y;y++)if((l=r?d(_(s=t[y])[0],s[1]):d(t[y]))===e||l===n)return l};r.BREAK=e,r.RETURN=n}),Ut=ct("species"),Ht=function(t,e){var n,r=_(t).constructor;return void 0===r||void 0==(n=_(r)[Ut])?e:d(n)},zt=p.process,Jt=p.setImmediate,Qt=p.clearImmediate,Xt=p.MessageChannel,Zt=p.Dispatch,$t=0,te={},ee=function(){var t=+this;if(te.hasOwnProperty(t)){var e=te[t];delete te[t],e()}},ne=function(t){ee.call(t.data)};Jt&&Qt||(Jt=function(t){for(var e=[],n=1;arguments.length>n;)e.push(arguments[n++]);return te[++$t]=function(){!function(t,e,n){var r=void 0===n;switch(e.length){case 0:return r?t():t.call(n);case 1:return r?t(e[0]):t.call(n,e[0]);case 2:return r?t(e[0],e[1]):t.call(n,e[0],e[1]);case 3:return r?t(e[0],e[1],e[2]):t.call(n,e[0],e[1],e[2]);case 4:return r?t(e[0],e[1],e[2],e[3]):t.call(n,e[0],e[1],e[2],e[3])}t.apply(n,e)}("function"==typeof t?t:Function(t),e)},Ft($t),$t},Qt=function(t){delete te[t]},"process"==u(zt)?Ft=function(t){zt.nextTick(v(ee,t,1))}:Zt&&Zt.now?Ft=function(t){Zt.now(v(ee,t,1))}:Xt?(Vt=(Wt=new Xt).port2,Wt.port1.onmessage=ne,Ft=v(Vt.postMessage,Vt,1)):p.addEventListener&&"function"==typeof postMessage&&!p.importScripts?(Ft=function(t){p.postMessage(t+"","*")},p.addEventListener("message",ne,!1)):Ft="onreadystatechange"in C("script")?function(t){et.appendChild(C("script")).onreadystatechange=function(){et.removeChild(this),ee.call(t)}}:function(t){setTimeout(v(ee,t,1),0)});var re={set:Jt,clear:Qt},oe=re.set,ie=p.MutationObserver||p.WebKitMutationObserver,ce=p.process,ae=p.Promise,ue="process"==u(ce);var se={f:function(t){return new function(t){var e,n;this.promise=new t(function(t,r){if(void 0!==e||void 0!==n)throw TypeError("Bad Promise constructor");e=t,n=r}),this.resolve=d(e),this.reject=d(n)}(t)}},fe=function(t){try{return{e:!1,v:t()}}catch(t){return{e:!0,v:t}}},le=p.navigator,pe=le&&le.userAgent||"",he=function(t,e){if(_(t),y(e)&&e.constructor===t)return e;var n=se.f(t);return(0,n.resolve)(e),n.promise},de=ct("species"),ve=ct("iterator"),ye=!1;try{[7][ve]().return=function(){ye=!0}}catch(t){}var _e,me,ge,be,we,Ce,Se=re.set,Oe=function(){var t,e,n,r=function(){var r,o;for(ue&&(r=ce.domain)&&r.exit();t;){o=t.fn,t=t.next;try{o()}catch(r){throw t?n():e=void 0,r}}e=void 0,r&&r.enter()};if(ue)n=function(){ce.nextTick(r)};else if(!ie||p.navigator&&p.navigator.standalone)if(ae&&ae.resolve){var o=ae.resolve(void 0);n=function(){o.then(r)}}else n=function(){oe.call(p,r)};else{var i=!0,c=document.createTextNode("");new ie(r).observe(c,{characterData:!0}),n=function(){c.data=i=!i}}return function(r){var o={fn:r,next:void 0};e&&(e.next=o),t||(t=o,n()),e=o}}(),Ee=p.TypeError,Ae=p.process,Pe=Ae&&Ae.versions,Te=Pe&&Pe.v8||"",je=p.Promise,xe="process"==xt(Ae),Ie=function(){},Le=me=se.f,Me=!!function(){try{var t=je.resolve(1),e=(t.constructor={})[ct("species")]=function(t){t(Ie,Ie)};return(xe||"function"==typeof PromiseRejectionEvent)&&t.then(Ie)instanceof e&&0!==Te.indexOf("6.6")&&-1===pe.indexOf("Chrome/66")}catch(t){}}(),Re=function(t){var e;return!(!y(t)||"function"!=typeof(e=t.then))&&e},Ne=function(t,e){if(!t._n){t._n=!0;var n=t._c;Oe(function(){for(var r=t._v,o=1==t._s,i=0,c=function(e){var n,i,c,a=o?e.ok:e.fail,u=e.resolve,s=e.reject,f=e.domain;try{a?(o||(2==t._h&&Fe(t),t._h=1),!0===a?n=r:(f&&f.enter(),n=a(r),f&&(f.exit(),c=!0)),n===e.promise?s(Ee("Promise-chain cycle")):(i=Re(n))?i.call(n,u,s):u(n)):s(r)}catch(t){f&&!c&&f.exit(),s(t)}};n.length>i;)c(n[i++]);t._c=[],t._n=!1,e&&!t._h&&De(t)})}},De=function(t){Se.call(p,function(){var e,n,r,o=t._v,i=ke(t);if(i&&(e=fe(function(){xe?Ae.emit("unhandledRejection",o,t):(n=p.onunhandledrejection)?n({promise:t,reason:o}):(r=p.console)&&r.error&&r.error("Unhandled promise rejection",o)}),t._h=xe||ke(t)?2:1),t._a=void 0,i&&e.e)throw e.v})},ke=function(t){return 1!==t._h&&0===(t._a||t._c).length},Fe=function(t){Se.call(p,function(){var e;xe?Ae.emit("rejectionHandled",t):(e=p.onrejectionhandled)&&e({promise:t,reason:t._v})})},We=function(t){var e=this;e._d||(e._d=!0,(e=e._w||e)._v=t,e._s=2,e._a||(e._a=e._c.slice()),Ne(e,!0))},Ve=function(t){var e,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===t)throw Ee("Promise can't be resolved itself");(e=Re(t))?Oe(function(){var r={_w:n,_d:!1};try{e.call(t,v(Ve,r,1),v(We,r,1))}catch(t){We.call(r,t)}}):(n._v=t,n._s=1,Ne(n,!1))}catch(t){We.call({_w:n,_d:!1},t)}}};Me||(je=function(t){!function(t,e,n,r){if(!(t instanceof e)||void 0!==r&&r in t)throw TypeError(n+": incorrect invocation!")}(this,je,"Promise","_h"),d(t),_e.call(this);try{t(v(Ve,this,1),v(We,this,1))}catch(t){We.call(this,t)}},(_e=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=function(t,e,n){for(var r in e)n&&t[r]?t[r]=e[r]:T(t,r,e[r]);return t}(je.prototype,{then:function(t,e){var n=Le(Ht(this,je));return n.ok="function"!=typeof t||t,n.fail="function"==typeof e&&e,n.domain=xe?Ae.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&Ne(this,!1),n.promise},catch:function(t){return this.then(void 0,t)}}),ge=function(){var t=new _e;this.promise=t,this.resolve=v(Ve,t,1),this.reject=v(We,t,1)},se.f=Le=function(t){return t===je||t===be?new ge(t):me(t)}),M(M.G+M.W+M.F*!Me,{Promise:je}),st(je,"Promise"),Ce="function"==typeof h[we="Promise"]?h[we]:p[we],g&&Ce&&!Ce[de]&&A.f(Ce,de,{configurable:!0,get:function(){return this}}),be=h.Promise,M(M.S+M.F*!Me,"Promise",{reject:function(t){var e=Le(this);return(0,e.reject)(t),e.promise}}),M(M.S+!0*M.F,"Promise",{resolve:function(t){return he(this===be?je:this,t)}}),M(M.S+M.F*!(Me&&function(t,e){if(!e&&!ye)return!1;var n=!1;try{var r=[7],o=r[ve]();o.next=function(){return{done:n=!0}},r[ve]=function(){return o},t(r)}catch(t){}return n}(function(t){je.all(t).catch(Ie)})),"Promise",{all:function(t){var e=this,n=Le(e),r=n.resolve,o=n.reject,i=fe(function(){var n=[],i=0,c=1;qt(t,!1,function(t){var a=i++,u=!1;n.push(void 0),c++,e.resolve(t).then(function(t){u||(u=!0,n[a]=t,--c||r(n))},o)}),--c||r(n)});return i.e&&o(i.v),n.promise},race:function(t){var e=this,n=Le(e),r=n.reject,o=fe(function(){qt(t,!1,function(t){e.resolve(t).then(n.resolve,r)})});return o.e&&r(o.v),n.promise}}),M(M.P+M.R,"Promise",{finally:function(t){var e=Ht(this,h.Promise||p.Promise),n="function"==typeof t;return this.then(n?function(n){return he(e,t()).then(function(){return n})}:t,n?function(n){return he(e,t()).then(function(){throw n})}:t)}}),M(M.S,"Promise",{try:function(t){var e=se.f(this),n=fe(t);return(n.e?e.reject:e.resolve)(n.v),e.promise}});var Ge=h.Promise,Ke=r(o(function(t){t.exports={default:Ge,__esModule:!0}})),Ye={f:Object.getOwnPropertySymbols},Be={f:{}.propertyIsEnumerable},qe=Object.assign,Ue=!qe||m(function(){var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach(function(t){e[t]=t}),7!=qe({},t)[n]||Object.keys(qe({},e)).join("")!=r})?function(t,e){for(var n=pt(t),r=arguments.length,o=1,i=Ye.f,c=Be.f;r>o;)for(var a,u=s(arguments[o++]),f=i?Z(u).concat(i(u)):Z(u),l=f.length,p=0;l>p;)c.call(u,a=f[p++])&&(n[a]=u[a]);return n}:qe;M(M.S+M.F,"Object",{assign:Ue});var He=h.Object.assign,ze=r(o(function(t){t.exports={default:He,__esModule:!0}})),Je=r(o(function(t,e){e.__esModule=!0,e.default=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}})),Qe={f:ct},Xe=Qe.f("iterator"),Ze=o(function(t){t.exports={default:Xe,__esModule:!0}});r(Ze);var $e=o(function(t){var e=q("meta"),n=A.f,r=0,o=Object.isExtensible||function(){return!0},i=!m(function(){return o(Object.preventExtensions({}))}),c=function(t){n(t,e,{value:{i:"O"+ ++r,w:{}}})},a=t.exports={KEY:e,NEED:!1,fastKey:function(t,n){if(!y(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!x(t,e)){if(!o(t))return"F";if(!n)return"E";c(t)}return t[e].i},getWeak:function(t,n){if(!x(t,e)){if(!o(t))return!0;if(!n)return!1;c(t)}return t[e].w},onFreeze:function(t){return i&&a.NEED&&o(t)&&!x(t,e)&&c(t),t}}}),tn=($e.KEY,$e.NEED,$e.fastKey,$e.getWeak,$e.onFreeze,A.f),en=function(t){var e=h.Symbol||(h.Symbol={});"_"==t.charAt(0)||t in e||tn(e,t,{value:Qe.f(t)})},nn=Array.isArray||function(t){return"Array"==u(t)},rn=X.concat("length","prototype"),on={f:Object.getOwnPropertyNames||function(t){return Q(t,rn)}},cn=on.f,an={}.toString,un="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],sn={f:function(t){return un&&"[object Window]"==an.call(t)?function(t){try{return cn(t)}catch(t){return un.slice()}}(t):cn(l(t))}},fn=Object.getOwnPropertyDescriptor,ln={f:g?fn:function(t,e){if(t=l(t),e=O(e,!0),S)try{return fn(t,e)}catch(t){}if(x(t,e))return P(!Be.f.call(t,e),t[e])}},pn=$e.KEY,hn=ln.f,dn=A.f,vn=sn.f,yn=p.Symbol,_n=p.JSON,mn=_n&&_n.stringify,gn=ct("_hidden"),bn=ct("toPrimitive"),wn={}.propertyIsEnumerable,Cn=K("symbol-registry"),Sn=K("symbols"),On=K("op-symbols"),En=Object.prototype,An="function"==typeof yn,Pn=p.QObject,Tn=!Pn||!Pn.prototype||!Pn.prototype.findChild,jn=g&&m(function(){return 7!=it(dn({},"a",{get:function(){return dn(this,"a",{value:7}).a}})).a})?function(t,e,n){var r=hn(En,e);r&&delete En[e],dn(t,e,n),r&&t!==En&&dn(En,e,r)}:dn,xn=function(t){var e=Sn[t]=it(yn.prototype);return e._k=t,e},In=An&&"symbol"==typeof yn.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof yn},Ln=function(t,e,n){return t===En&&Ln(On,e,n),_(t),e=O(e,!0),_(n),x(Sn,e)?(n.enumerable?(x(t,gn)&&t[gn][e]&&(t[gn][e]=!1),n=it(n,{enumerable:P(0,!1)})):(x(t,gn)||dn(t,gn,P(1,{})),t[gn][e]=!0),jn(t,e,n)):dn(t,e,n)},Mn=function(t,e){_(t);for(var n,r=function(t){var e=Z(t),n=Ye.f;if(n)for(var r,o=n(t),i=Be.f,c=0;o.length>c;)i.call(t,r=o[c++])&&e.push(r);return e}(e=l(e)),o=0,i=r.length;i>o;)Ln(t,n=r[o++],e[n]);return t},Rn=function(t){var e=wn.call(this,t=O(t,!0));return!(this===En&&x(Sn,t)&&!x(On,t))&&(!(e||!x(this,t)||!x(Sn,t)||x(this,gn)&&this[gn][t])||e)},Nn=function(t,e){if(t=l(t),e=O(e,!0),t!==En||!x(Sn,e)||x(On,e)){var n=hn(t,e);return!n||!x(Sn,e)||x(t,gn)&&t[gn][e]||(n.enumerable=!0),n}},Dn=function(t){for(var e,n=vn(l(t)),r=[],o=0;n.length>o;)x(Sn,e=n[o++])||e==gn||e==pn||r.push(e);return r},kn=function(t){for(var e,n=t===En,r=vn(n?On:l(t)),o=[],i=0;r.length>i;)!x(Sn,e=r[i++])||n&&!x(En,e)||o.push(Sn[e]);return o};An||(R((yn=function(){if(this instanceof yn)throw TypeError("Symbol is not a constructor!");var t=q(arguments.length>0?arguments[0]:void 0),e=function(n){this===En&&e.call(On,n),x(this,gn)&&x(this[gn],t)&&(this[gn][t]=!1),jn(this,t,P(1,n))};return g&&Tn&&jn(En,t,{configurable:!0,set:e}),xn(t)}).prototype,"toString",function(){return this._k}),ln.f=Nn,A.f=Ln,on.f=sn.f=Dn,Be.f=Rn,Ye.f=kn,Qe.f=function(t){return xn(ct(t))}),M(M.G+M.W+M.F*!An,{Symbol:yn});for(var Fn="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),Wn=0;Fn.length>Wn;)ct(Fn[Wn++]);for(var Vn=Z(ct.store),Gn=0;Vn.length>Gn;)en(Vn[Gn++]);M(M.S+M.F*!An,"Symbol",{for:function(t){return x(Cn,t+="")?Cn[t]:Cn[t]=yn(t)},keyFor:function(t){if(!In(t))throw TypeError(t+" is not a symbol!");for(var e in Cn)if(Cn[e]===t)return e},useSetter:function(){Tn=!0},useSimple:function(){Tn=!1}}),M(M.S+M.F*!An,"Object",{create:function(t,e){return void 0===e?it(t):Mn(it(t),e)},defineProperty:Ln,defineProperties:Mn,getOwnPropertyDescriptor:Nn,getOwnPropertyNames:Dn,getOwnPropertySymbols:kn}),_n&&M(M.S+M.F*(!An||m(function(){var t=yn();return"[null]"!=mn([t])||"{}"!=mn({a:t})||"{}"!=mn(Object(t))})),"JSON",{stringify:function(t){for(var e,n,r=[t],o=1;arguments.length>o;)r.push(arguments[o++]);if(n=e=r[1],(y(e)||void 0!==t)&&!In(t))return nn(e)||(e=function(t,e){if("function"==typeof n&&(e=n.call(this,t,e)),!In(e))return e}),r[1]=e,mn.apply(_n,r)}}),yn.prototype[bn]||T(yn.prototype,bn,yn.prototype.valueOf),st(yn,"Symbol"),st(Math,"Math",!0),st(p.JSON,"JSON",!0),en("asyncIterator"),en("observable");var Kn=h.Symbol,Yn=o(function(t){t.exports={default:Kn,__esModule:!0}});r(Yn);var Bn=o(function(t,e){e.__esModule=!0;var n=i(Ze),r=i(Yn),o="function"==typeof r.default&&"symbol"==typeof n.default?function(t){return typeof t}:function(t){return t&&"function"==typeof r.default&&t.constructor===r.default&&t!==r.default.prototype?"symbol":typeof t};function i(t){return t&&t.__esModule?t:{default:t}}e.default="function"==typeof r.default&&"symbol"===o(n.default)?function(t){return void 0===t?"undefined":o(t)}:function(t){return t&&"function"==typeof r.default&&t.constructor===r.default&&t!==r.default.prototype?"symbol":void 0===t?"undefined":o(t)}});r(Bn);var qn=r(o(function(t,e){e.__esModule=!0;var n,r=(n=Bn)&&n.__esModule?n:{default:n};e.default=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":(0,r.default)(e))&&"function"!=typeof e?t:e}})),Un=function(t,e){if(_(t),!y(e)&&null!==e)throw TypeError(e+": can't set as prototype!")},Hn={set:Object.setPrototypeOf||("__proto__"in{}?function(t,e,n){try{(n=v(Function.call,ln.f(Object.prototype,"__proto__").set,2))(t,[]),e=!(t instanceof Array)}catch(t){e=!0}return function(t,r){return Un(t,r),e?t.__proto__=r:n(t,r),t}}({},!1):void 0),check:Un};M(M.S,"Object",{setPrototypeOf:Hn.set});var zn=h.Object.setPrototypeOf,Jn=o(function(t){t.exports={default:zn,__esModule:!0}});r(Jn),M(M.S,"Object",{create:it});var Qn=h.Object,Xn=function(t,e){return Qn.create(t,e)},Zn=o(function(t){t.exports={default:Xn,__esModule:!0}});r(Zn);var $n=r(o(function(t,e){e.__esModule=!0;var n=i(Jn),r=i(Zn),o=i(Bn);function i(t){return t&&t.__esModule?t:{default:t}}e.default=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":(0,o.default)(e)));t.prototype=(0,r.default)(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(n.default?(0,n.default)(t,e):t.__proto__=e)}})),tr=o(function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}function o(t,e,r,o,i){if("function"!=typeof r)throw new TypeError("The listener must be a function");var c=new function(t,e,n){this.fn=t,this.context=e,this.once=n||!1}(r,o||t,i),a=n?n+e:e;return t._events[a]?t._events[a].fn?t._events[a]=[t._events[a],c]:t._events[a].push(c):(t._events[a]=c,t._eventsCount++),t}function i(t,e){0==--t._eventsCount?t._events=new r:delete t._events[e]}function c(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),c.prototype.eventNames=function(){var t,r,o=[];if(0===this._eventsCount)return o;for(r in t=this._events)e.call(t,r)&&o.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(t)):o},c.prototype.listeners=function(t){var e=n?n+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var o=0,i=r.length,c=new Array(i);o<i;o++)c[o]=r[o].fn;return c},c.prototype.listenerCount=function(t){var e=n?n+t:t,r=this._events[e];return r?r.fn?1:r.length:0},c.prototype.emit=function(t,e,r,o,i,c){var a=n?n+t:t;if(!this._events[a])return!1;var u,s,f=this._events[a],l=arguments.length;if(f.fn){switch(f.once&&this.removeListener(t,f.fn,void 0,!0),l){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,e),!0;case 3:return f.fn.call(f.context,e,r),!0;case 4:return f.fn.call(f.context,e,r,o),!0;case 5:return f.fn.call(f.context,e,r,o,i),!0;case 6:return f.fn.call(f.context,e,r,o,i,c),!0}for(s=1,u=new Array(l-1);s<l;s++)u[s-1]=arguments[s];f.fn.apply(f.context,u)}else{var p,h=f.length;for(s=0;s<h;s++)switch(f[s].once&&this.removeListener(t,f[s].fn,void 0,!0),l){case 1:f[s].fn.call(f[s].context);break;case 2:f[s].fn.call(f[s].context,e);break;case 3:f[s].fn.call(f[s].context,e,r);break;case 4:f[s].fn.call(f[s].context,e,r,o);break;default:if(!u)for(p=1,u=new Array(l-1);p<l;p++)u[p-1]=arguments[p];f[s].fn.apply(f[s].context,u)}}return!0},c.prototype.on=function(t,e,n){return o(this,t,e,n,!1)},c.prototype.once=function(t,e,n){return o(this,t,e,n,!0)},c.prototype.removeListener=function(t,e,r,o){var c=n?n+t:t;if(!this._events[c])return this;if(!e)return i(this,c),this;var a=this._events[c];if(a.fn)a.fn!==e||o&&!a.once||r&&a.context!==r||i(this,c);else{for(var u=0,s=[],f=a.length;u<f;u++)(a[u].fn!==e||o&&!a[u].once||r&&a[u].context!==r)&&s.push(a[u]);s.length?this._events[c]=1===s.length?s[0]:s:i(this,c)}return this},c.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&i(this,e)):(this._events=new r,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=n,c.EventEmitter=c,t.exports=c});M(M.S+M.F*!g,"Object",{defineProperty:A.f});var er=h.Object,nr=function(t,e,n){return er.defineProperty(t,e,n)},rr=o(function(t){t.exports={default:nr,__esModule:!0}});r(rr);var or=r(o(function(t,e){e.__esModule=!0;var n,r=(n=rr)&&n.__esModule?n:{default:n};e.default=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),(0,r.default)(t,o.key,o)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}()})),ir=o(function(t,e){var n;n={VERSION:"2.4.0",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,PENDING:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(t,e){var r="string"==typeof t.initial?{state:t.initial}:t.initial,o=t.terminal||t.final,i=e||t.target||{},c=t.events||[],a=t.callbacks||{},u={},s={},f=function(t){var e=Array.isArray(t.from)?t.from:t.from?[t.from]:[n.WILDCARD];u[t.name]=u[t.name]||{};for(var r=0;r<e.length;r++)s[e[r]]=s[e[r]]||[],s[e[r]].push(t.name),u[t.name][e[r]]=t.to||e[r];t.to&&(s[t.to]=s[t.to]||[])};r&&(r.event=r.event||"startup",f({name:r.event,from:"none",to:r.state}));for(var l=0;l<c.length;l++)f(c[l]);for(var p in u)u.hasOwnProperty(p)&&(i[p]=n.buildEvent(p,u[p]));for(var p in a)a.hasOwnProperty(p)&&(i[p]=a[p]);return i.current="none",i.is=function(t){return Array.isArray(t)?t.indexOf(this.current)>=0:this.current===t},i.can=function(t){return!this.transition&&void 0!==u[t]&&(u[t].hasOwnProperty(this.current)||u[t].hasOwnProperty(n.WILDCARD))},i.cannot=function(t){return!this.can(t)},i.transitions=function(){return(s[this.current]||[]).concat(s[n.WILDCARD]||[])},i.isFinished=function(){return this.is(o)},i.error=t.error||function(t,e,n,r,o,i,c){throw c||i},i.states=function(){return Object.keys(s).sort()},r&&!r.defer&&i[r.event](),i},doCallback:function(t,e,r,o,i,c){if(e)try{return e.apply(t,[r,o,i].concat(c))}catch(e){return t.error(r,o,i,c,n.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",e)}},beforeAnyEvent:function(t,e,r,o,i){return n.doCallback(t,t.onbeforeevent,e,r,o,i)},afterAnyEvent:function(t,e,r,o,i){return n.doCallback(t,t.onafterevent||t.onevent,e,r,o,i)},leaveAnyState:function(t,e,r,o,i){return n.doCallback(t,t.onleavestate,e,r,o,i)},enterAnyState:function(t,e,r,o,i){return n.doCallback(t,t.onenterstate||t.onstate,e,r,o,i)},changeState:function(t,e,r,o,i){return n.doCallback(t,t.onchangestate,e,r,o,i)},beforeThisEvent:function(t,e,r,o,i){return n.doCallback(t,t["onbefore"+e],e,r,o,i)},afterThisEvent:function(t,e,r,o,i){return n.doCallback(t,t["onafter"+e]||t["on"+e],e,r,o,i)},leaveThisState:function(t,e,r,o,i){return n.doCallback(t,t["onleave"+r],e,r,o,i)},enterThisState:function(t,e,r,o,i){return n.doCallback(t,t["onenter"+o]||t["on"+o],e,r,o,i)},beforeEvent:function(t,e,r,o,i){if(!1===n.beforeThisEvent(t,e,r,o,i)||!1===n.beforeAnyEvent(t,e,r,o,i))return!1},afterEvent:function(t,e,r,o,i){n.afterThisEvent(t,e,r,o,i),n.afterAnyEvent(t,e,r,o,i)},leaveState:function(t,e,r,o,i){var c=n.leaveThisState(t,e,r,o,i),a=n.leaveAnyState(t,e,r,o,i);return!1!==c&&!1!==a&&(n.ASYNC===c||n.ASYNC===a?n.ASYNC:void 0)},enterState:function(t,e,r,o,i){n.enterThisState(t,e,r,o,i),n.enterAnyState(t,e,r,o,i)},buildEvent:function(t,e){return function(){var r=this.current,o=e[r]||(e[n.WILDCARD]!=n.WILDCARD?e[n.WILDCARD]:r)||r,i=Array.prototype.slice.call(arguments);if(this.transition)return this.error(t,r,o,i,n.Error.PENDING_TRANSITION,"event "+t+" inappropriate because previous transition did not complete");if(this.cannot(t))return this.error(t,r,o,i,n.Error.INVALID_TRANSITION,"event "+t+" inappropriate in current state "+this.current);if(!1===n.beforeEvent(this,t,r,o,i))return n.Result.CANCELLED;if(r===o)return n.afterEvent(this,t,r,o,i),n.Result.NOTRANSITION;var c=this;this.transition=function(){return c.transition=null,c.current=o,n.enterState(c,t,r,o,i),n.changeState(c,t,r,o,i),n.afterEvent(c,t,r,o,i),n.Result.SUCCEEDED},this.transition.cancel=function(){c.transition=null,n.afterEvent(c,t,r,o,i)};var a=n.leaveState(this,t,r,o,i);return!1===a?(this.transition=null,n.Result.CANCELLED):n.ASYNC===a?n.Result.PENDING:this.transition?this.transition():void 0}}},t.exports&&(e=t.exports=n),e.StateMachine=n}),cr=(ir.StateMachine,function(){return ir.create({initial:"calling",events:[{name:"connect",from:"calling",to:"connected"},{name:"close",from:"connected",to:"closed"},{name:"cancel",from:"calling",to:"canceled"},{name:"refuse",from:"calling",to:"refused"}]})}),ar=o(function(t,e){!function(e){var n=function(){return"_"}.toString().indexOf("_")>-1,r=function(){},o=Object.prototype.hasOwnProperty,i=Object.create||function(t){var e=function(){};return e.prototype=t,new e},c=Object.keys||function(t){var e=[];for(var n in t)o.call(t,n)&&e.push(n);return e},a=function(t,e){for(var n in e)o.call(e,n)&&(t[n]=e[n]);return t},u=Object.prototype.toString,s=Array.isArray||function(t){return"[object Array]"===u.call(t)},f=function(t){return"[object Function]"===u.call(t)},l=function(){},p=!0,h={toString:""};for(var d in h)h.hasOwnProperty(d)&&(p=!1);var v=p?["toString","valueOf"]:null;function y(t,e,r){for(var o,i,a=function(t){var e=c(t);if(p)for(var n,r=0;n=v[r++];)t.hasOwnProperty(n)&&e.push(n);return e}(r),u=0,s=a.length;u<s;)"__self"!==(o=a[u++])&&(i=r[o],!f(i)||i.prototype&&i.prototype.__self||n&&!(i.toString().indexOf(".__base")>-1)?e[o]=i:e[o]=function(n,r){var o=t[n]?t[n]:"__constructor"===n?e.__self.__parent:l,i=function(){var t=this.__base;this.__base=i.__base;var e=r.apply(this,arguments);return this.__base=t,e};return i.__base=o,i}(o,i))}function _(t,e){for(var n,r=1;n=t[r++];)e?f(n)?m.self(e,n.prototype,n):m.self(e,n):e=f(n)?m(t[0],n.prototype,n):m(t[0],n);return e||t[0]}function m(){var t=arguments,e=s(t[0]),n=e||f(t[0]),o=n?e?_(t[0]):t[0]:r,c=t[n?1:0]||{},u=t[n?2:1],l=c.__constructor||n&&o.prototype&&o.prototype.__constructor?function(){return this.__constructor.apply(this,arguments)}:n?function(){return o.apply(this,arguments)}:function(){};if(!n)return l.prototype=c,l.prototype.__self=l.prototype.constructor=l,a(l,u);a(l,o),l.__parent=o;var p=o.prototype,h=l.prototype=i(p);return h.__self=h.constructor=l,c&&y(p,h,c),u&&y(o,l,u),l}m.self=function(){var t=arguments,e=s(t[0])?_(t[0],t[0][0]):t[0],n=t[1],r=t[2],o=e.prototype;return n&&y(o,o,n),r&&y(e,e,r),e};var g=!0;t.exports=m,g=!1,"object"==typeof modules&&"function"==typeof modules.define&&(modules.define("inherit",function(t){t(m)}),g=!1),g&&(e.inherit=m)}(n)});if(!e.TypedMessage)throw new Error("LeanCloud Realtime SDK not installed");var ur,sr=ar(e.TypedMessage,{__constructor:function(t){this.__base(),this.payload=t}});sr.sendOptions={transient:!0},e.messageField("payload")(sr);var fr,lr,pr,hr,dr=e.messageType(-102)(ur=function(t){function e(){return Je(this,e),qn(this,t.apply(this,arguments))}return $n(e,t),e}(sr))||ur,vr=e.messageType(-103)(fr=function(t){function e(){return Je(this,e),qn(this,t.apply(this,arguments))}return $n(e,t),e}(sr))||fr,yr=e.messageType(-104)(lr=function(t){function e(){return Je(this,e),qn(this,t.apply(this,arguments))}return $n(e,t),e}(sr))||lr,_r=e.messageType(-105)(pr=function(t){function e(){return Je(this,e),qn(this,t.apply(this,arguments))}return $n(e,t),e}(sr))||pr,mr=function(t){function e(n,r){Je(this,e);var o=qn(this,t.call(this));o._setConversation(n),o._peerConnection=o._createPeerConnection(r),o._call=cr(),o._promises={};var i=new Ke(function(t){o._promises.resolveStreamReady=t}),c=new Ke(function(t){o._promises.resolveAccept=t});return Ke.all([i,c]).then(function(t){var e=Gt(t,1)[0];o._call.can("connect")&&(o._call.connect(),o.emit("connect",e))}),o}return $n(e,t),e.prototype.close=function(){var t=this;return Ke.resolve().then(function(){t._call.close(),t._destroyPeerConnection(),t._peerConnection.close(),t._destroy()})},e.prototype._handleCloseEvent=function(){this._call.can("close")&&(this.close(),this.emit("close"))},e.prototype._setConversation=function(t){this._conversation&&this._conversation.off("message"),t&&(this._conversation=t,t.on("message",this._handleMessage.bind(this)))},e.prototype._destroy=function(){this._conversation.off("message")},e.prototype._createPeerConnection=function(t){var e=new RTCPeerConnection(t);return e.onicecandidate=this._handleICECandidateEvent.bind(this),e.onaddstream=this._handleAddStreamEvent.bind(this),e.onnremovestream=this._handleRemoveStreamEvent.bind(this),e.oniceconnectionstatechange=this._handleICEConnectionStateChangeEvent.bind(this),e.onsignalingstatechange=this._handleSignalingStateChangeEvent.bind(this),e},e.prototype._destroyPeerConnection=function(){var t=this._peerConnection;delete t.onaddstream,delete t.onremovestream,delete t.onnicecandidate,delete t.oniceconnectionstatechange,delete t.onsignalingstatechange},e.prototype._handleMessage=function(t){return t instanceof dr?this._handleAnswer(t):t instanceof yr?this._handleRefusal():t instanceof _r?this._handleCancelation():t instanceof vr&&this._handleICECandidate(t)},e.prototype._handleICECandidate=function(t){var e=new RTCIceCandidate(t.payload);this._peerConnection&&this._peerConnection.addIceCandidate(e).catch(console.error.bind(console))},e.prototype._handleICECandidateEvent=function(t){return!(!t.candidate||!this._conversation)&&this._conversation.send(new vr(t.candidate)).catch(console.error.bind(console))},e.prototype._handleAddStreamEvent=function(t){this._promises.resolveStreamReady(t.stream)},e.prototype._handleRemoveStreamEvent=function(){this._handleCloseEvent()},e.prototype._handleICEConnectionStateChangeEvent=function(){switch(this._peerConnection.iceConnectionState){case"closed":case"failed":case"disconnected":this._handleCloseEvent()}},e.prototype._handleSignalingStateChangeEvent=function(){switch(this._peerConnection.signalingState){case"closed":this._handleCloseEvent()}},e.prototype._handleAnswer=function(){throw new Error("not implemented")},e.prototype._handleRefusal=function(){throw new Error("not implemented")},e.prototype._handleCancelation=function(){throw new Error("not implemented")},or(e,[{key:"state",get:function(){return this._call.current}}]),e}(tr),gr=function(t){function e(n,r,o){Je(this,e);var i=qn(this,t.call(this,r,o));return i.to=n,i}return $n(e,t),e.prototype._handleAnswer=function(t){var e=new RTCSessionDescription(t.payload);this._peerConnection.setRemoteDescription(e),this._promises.resolveAccept()},e.prototype._handleRefusal=function(){this._destroyPeerConnection(),this._call.refuse(),this.emit("refuse"),this._destroy()},e.prototype.cancel=function(){var t=this;return this._call.cancel(),this._conversation.send(new _r).then(function(){return t._destroy()})},e.prototype.close=function(){return this._call.can("cancel")?this.cancel():t.prototype.close.call(this)},e}(mr),br=function(t){function e(n,r,o){Je(this,e);var i=qn(this,t.call(this,r,o));i.from=n.from;var c=new RTCSessionDescription(n.payload);return i._handleOfferPromise=i._peerConnection.setRemoteDescription(c),i}return $n(e,t),e.prototype.accept=function(t){var e=this;if(!t)throw new TypeError("a MediaStream instance is required to accept a call");return this._handleOfferPromise.then(function(){return e._peerConnection.addStream(t)}).then(function(){return e._peerConnection.createAnswer()}).then(function(t){return e._peerConnection.setLocalDescription(t)}).then(function(){return e._conversation.send(new dr(e._peerConnection.localDescription))}).then(function(){return e._promises.resolveAccept()})},e.prototype.refuse=function(){var t=this;return this._conversation.send(new yr).then(function(){t._call.refuse(),t._destroy()})},e.prototype._handleCancelation=function(){this._call.cancel(),this.emit("cancel"),this._destroy()},e}(mr),wr=e.messageType(-101)(hr=function(t){function e(){return Je(this,e),qn(this,t.apply(this,arguments))}return $n(e,t),e}(sr))||hr,Cr={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun3.l.google.com:19302","stun:stun4.l.google.com:19302","stun:stun.ekiga.net","stun:stun.ideasip.com","stun:stun.rixtelecom.se","stun:stun.schlund.de","stun:stun.stunprotocol.org:3478","stun:stun.voiparound.com","stun:stun.voipbuster.com","stun:stun.voipstunt.com","stun:stun.voxgratia.org"]}]},Sr=function(t){function e(n,r){if(Je(this,e),"string"!=typeof n)throw new TypeError("id is not a string");var o=qn(this,t.call(this));return o.id=n,o.options=ze({RTCConfiguration:Cr},r),o}return $n(e,t),e.prototype._open=function(t,e){var n=this;return t.createIMClient(this.id,e,"webrtc").then(function(t){return n._imClient=t,n.id=t.id,t.on("message",function(t,e){return t instanceof wr&&n._handleOffer(t,e)}),t.on("conflict",function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return n.emit.apply(n,["conflict"].concat(e))}),n})},e.prototype.close=function(){return this._imClient.close()},e.prototype.call=function(t,e){var n=this;if("string"!=typeof t)throw new TypeError("target id is not a string");if(!e)throw new TypeError("a MediaStream instance is required to make a call");return this._imClient.ping([t]).then(function(r){if(!r.length)throw new Error("Call failed as "+t+" is not online");var o=new gr(t,null,n.options.RTCConfiguration),i=new Ke(function(t){o._peerConnection.onnegotiationneeded=t});return o._peerConnection.addStream(e),i.then(function(){return Ke.all([n._imClient.createConversation({members:[t],unique:!0}),o._peerConnection.createOffer().then(function(t){o._peerConnection.setLocalDescription(t)})])}).then(function(t){var e=Gt(t,1)[0];return o._setConversation(e),e.send(new wr(o._peerConnection.localDescription))}).then(function(){return o})})},e.prototype._handleOffer=function(t,e){var n=new br(t,e,this.options.RTCConfiguration);this.emit("call",n)},e}(tr),Or={name:"leancloud-realtime-plugin-webrtc",messageClasses:[wr,dr,vr,yr,_r],onRealtimeCreate:function(t){t.createWebRTCClient=function(e,n){return new Sr(e)._open(t,n)}}},Er=!!(window.RTCPeerConnection&&window.RTCSessionDescription&&window.RTCIceCandidate);t.WebRTCPlugin=Or,t.isWebRTCSupported=Er,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=webrtc.min.js.map
